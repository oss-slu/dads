name: Build AsciiDoc Documentation

permissions:
  contents: read
  pull-requests: write

on:
  push:
    branches:
    - develop
    paths:
      - 'docs/**'
      - '.github/workflows/asciidoc-build.yml'

jobs:
  adoc_build:
    runs-on: ubuntu-latest
    name: Asciidoctoring the docs to pretty HTML!

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Build AsciiDoc files
      uses: addnab/docker-run-action@v3
      with:
        image: asciidoctor/docker-asciidoctor:latest
        run: |
          mkdir -p docs
          asciidoctor -D docs \
            -a stylesheet=style.css \
            -b html5 \
            -o index.html \
            ./docs/index.adoc
          echo 'docs.upsilonproject.io' > docs/CNAME

    - name: Upload built docs as artifact
      uses: actions/upload-artifact@v4
      with:
        name: docs-html
        path: docs/

    
    - name: Deploy docs to ghpages
      uses: peaceiris/actions-gh-pages@v3
      with:
        deploy_key: ${{ secrets.ACTIONS_DEPLOY_KEY }}
        publish_branch: gh-pages
        publish_dir: ./docs/
